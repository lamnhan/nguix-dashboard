<div class="host dashboard page" *ngIf="page$ | async as page; else loading">
  <div class="main" *ngIf="page.ok; else notFound">
  <ng-container *ngIf="data$ | async; let data">
  <ng-container *ngIf="data.listingItems | userQueryFilter : query; let filteredItems">
  <ng-container *ngIf="filteredItems | userRoleFilter : role | paginate : {itemsPerPage: viewPerPage, currentPage: pageNo}; let activeItems;">

    <div class="head">

      <div class="title">
        <h1>Users</h1>
      </div>

      <ul class="roles" *ngIf="filteredItems | userExtractRoles as listingRoles">
        <ng-container *ngFor="let listingRole of listingRoles">
          <li *ngIf="listingRole.count">
            <strong *ngIf="listingRole.value === role; else inactive">{{ listingRole.title }}</strong>
            <ng-template #inactive>
              <a href="#" (click)="role=listingRole.value; false">{{ listingRole.title }}</a>
            </ng-template>
            <em>({{ listingRole.count }})</em>
          </li>
        </ng-container>
      </ul>

    </div>

    <div class="body">
      
      <ng-template #listingBar>
        <div class="filter">
          <input
            class="form-control"
            type="search"
            placeholder="Filter items ..."
            [(ngModel)]="query"
          > 
        </div>
        <div class="counter">{{ activeItems.length }} items</div>
      </ng-template>

      <div class="headbar">
        <ng-container *ngTemplateOutlet="listingBar"></ng-container>
      </div>

      <div class="major">

        <table class="listing table-striped">

          <thead>
            <tr>
              <th class="username">Name</th>
              <th class="role">Role</th>
              <th class="date">Date</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let listingItem of activeItems">
              <td class="username">
                <a href="#" (click)="detailItem=listingItem;false">
                  <strong>{{ listingItem.id }}</strong>
                </a>
              </td>
              <td class="role">{{ listingItem | userGetRole }}</td>
              <td class="date">{{ listingItem.createdAt | date }}</td>
            </tr>
          </tbody>

          <tfoot>
            <tr>
              <td colspan="42">
                <pagination-controls
                  (pageChange)="changePage($event)"
                  [directionLinks]="false"
                ></pagination-controls>
              </td>
            </tr>
          </tfoot>

        </table>

        <div class="detail" [class.show]="detailItem" *ngIf="detailItem">
          <div class="top">
            <div class="title">
              <strong>{{ detailItem.id }}</strong>
            </div>
            <a href="#" (click)="detailItem=undefined;false">X</a>
          </div>
          <div class="content">
            <div class="image">
              <img [src]="(detailItem.thumbnails?.md || detailItem.thumbnails?.default)?.src" [alt]="detailItem.id">
            </div>
            <div class="username">
              <span>Username</span>
              <strong>
                <a href="#" target="_blank">{{ detailItem.id }}</a>
              </strong>
            </div>
            <div class="role">
              <span>Role</span>
              <strong>{{ detailItem | userGetRole }}</strong>
            </div>
            <div class="status">
              <span>Status</span>
              <strong>{{ detailItem.status === 'publish' ? 'Public' : 'Private' }}</strong>
            </div>
            <div class="created">
              <span>Created</span>
              <strong>{{ detailItem.createdAt | date }}</strong>
            </div>
            <div class="updated">
              <span>Updated</span>
              <strong>{{ detailItem.updatedAt | date }}</strong>
            </div>
          </div>
        </div>

      </div>
      
      <div class="footbar">
        <ng-container *ngTemplateOutlet="listingBar"></ng-container>
      </div>

    </div>

  </ng-container>
  </ng-container>
  </ng-container>
  </div>

  <ng-template #notFound>
    <div class="not-found">Not found ...</div>
  </ng-template>

</div>

<ng-template #loading>
  <div class="loading">Loading ...</div>
</ng-template>
