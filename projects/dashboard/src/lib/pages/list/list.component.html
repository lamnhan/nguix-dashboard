<div class="host dashboard page" *ngIf="page$ | async as page; else loading">

  <div class="main" *ngIf="page.part as part; else notFound">
  <ng-container *ngIf="data$ | async; let data">
  <ng-container *ngIf="data.listingItems | typeFilter: type | queryFilter : query; let filteredItems">

    <div class="head">

      <div class="title">
        <h1>All {{ part.menuItem.text || 'Items' }}</h1>
        <a
          class="button-outline-primary"
          [usefulRouterLink]="['app-admin', 'new', part.name]"
        >Add New</a>
      </div>

      <ul class="statuses" *ngIf="filteredItems | extractStatuses as listingStatuses">
        <ng-container *ngFor="let listingStatus of listingStatuses">
          <li *ngIf="listingStatus.count">
            <strong *ngIf="listingStatus.value === status; else inactive">{{ listingStatus.title }}</strong>
            <ng-template #inactive>
              <a href="#" (click)="status=listingStatus.value; false">{{ listingStatus.title }}</a>
            </ng-template>
            <em>({{ listingStatus.count }})</em>
          </li>
        </ng-container>
      </ul>

    </div>
    
    <div class="body">

      <ng-template #listingBar>
        <div class="filter">    
          <input
            class="form-control"
            type="search"
            placeholder="Filter items ..."
            [(ngModel)]="query"
          >    
        </div>
        <div class="counter">{{ counting.total }} items</div>
      </ng-template>

      <div class="headbar">
        <ng-container *ngTemplateOutlet="listingBar"></ng-container>
      </div>

      <ul class="type-filter" *ngIf="part.dataTypes && part.dataTypes.length > 1">
        <li *ngFor="let dataType of part.dataTypes" [class.active]="type===dataType.value">
          <a
            href="javascript:void(0)"
            (click)="type===dataType.value?false:type=dataType.value"
          >
            <i *ngIf="dataType.icon" class="icon-medium-tint" [class]="dataType.icon"></i>
            <span>{{ dataType.text }}</span>
          </a>
        </li>
      </ul>

      <table class="listing table-striped">  
        <thead>
          <tr>
            <th class="title">Title</th>
            <th class="author">Author</th>
            <th class="comment"><i class="icon-dark icon-dashboard-comment"></i></th>
            <th class="date">Date</th>
          </tr>
        </thead>  
        <tbody>
          <tr
            *ngFor="
              let listingItem of filteredItems
              | statusFilter : status
              | paginate: {itemsPerPage: 30, currentPage: pageNo}
              | listingCounter : counting
            "
          >
          <ng-container *ngIf="listingItem.all as items">
  
            <td class="title">  
              <ul>
                <li *ngFor="let item of items">

                  <div class="locale" *ngIf="item.locale">{{ data.recordLocales[item.locale].text }}</div>

                  <div class="major">
                    <span class="label" [class]="item.status" *ngIf="item.status!=='publish'">{{ item.status }}</span>
                    <!-- draft / publish -->
                    <ng-container *ngIf="item.status==='draft' || item.status==='publish'">
                      <a [usefulRouterLink]="['app-admin', 'edit', part.name, item.id]">{{ item.title }}</a>
                    </ng-container>
                    <!-- archive -->
                    <ng-container *ngIf="item.status==='archive'">
                      <a href="javascript:void(0)" (click)="dataService.unarchiveItem(part, item)">{{ item.title }}</a>
                    </ng-container>
                    <!-- trash -->
                    <ng-container *ngIf="item.status==='trash'">
                      <a href="javascript:void(0)" (click)="dataService.restoreItem(part, item)">{{ item.title }}</a>
                    </ng-container>
                  </div>  
  
                  <ul class="actions">

                    <!-- draft / publish -->
                    <ng-container *ngIf="item.status==='draft' || item.status==='publish'">
                    <li class="edit">
                      <a [usefulRouterLink]="['app-admin', 'edit', part.name, item.id]">Edit</a>
                    </li>
                    <li class="copy">
                      <a [usefulRouterLink]="['app-admin', 'copy', part.name, item.id]">Copy</a>
                    </li>
                    <li class="archive">
                      <a href="javascript:void(0)" (click)="dataService.archiveItem(part, item)">Archive</a>
                    </li>
                    <li class="trash">
                      <a href="javascript:void(0)" (click)="dataService.removeItem(part, item)">Trash</a>
                    </li>
                    <li class="preview">
                      <a href="javascript:void(0)" (click)="dataService.previewItem(part)">Preview</a>
                    </li>
                    </ng-container>

                    <!-- archive -->
                    <ng-container *ngIf="item.status==='archive'">
                    <li class="unarchive">
                      <a href="javascript:void(0)" (click)="dataService.unarchiveItem(part, item)">Unarchive</a>
                    </li>
                    </ng-container>

                    <!-- trash -->
                    <ng-container *ngIf="item.status==='trash'">
                    <li class="restore">
                      <a href="javascript:void(0)" (click)="dataService.restoreItem(part, item)">Restore</a>
                    </li>
                    </ng-container>

                    <li class="detail">
                      <a href="javascript:void(0)" (click)="detail=detail&&detail===item.id?'':item.id">Detail</a>
                    </li>

                  </ul>  
  
                  <ul class="mobile-detail" [class.show]="item.id===detail">
                    <li class="author" *ngIf="item.authors | o1i; let author">
                      <span>Author</span>
                      <a href="#">{{ author.title }}</a>
                    </li>
                    <li class="comment" *ngIf="item.commentCount">
                      <span>Comment</span>
                      <em>{{ item.commentCount }}</em>
                    </li>
                    <li class="date">
                      <span>Date</span>
                      <em>{{ item.updatedAt === item.createdAt ? 'Published' : 'Modified' }} — {{ item.updatedAt | date }}</em>
                    </li>
                  </ul>

                </li>

                <ng-container *ngIf="!part.noI18n">
                <ng-container *ngFor="let missingTranslation of listingItem.missingTranslations">
                  <li class="missing-item">
                    <div class="locale">{{ data.recordLocales[missingTranslation].text }}</div>
                    <div class="major">
                      <a
                        [usefulRouterLink]="['app-admin', 'copy', part.name, listingItem.origin.id]"
                        [usefulRouteExtras]="{queryParams: {locale: missingTranslation}}"
                      >Add the translation</a>
                    </div>
                  </li>
                </ng-container>
                </ng-container>

              </ul>
            </td>

            <td class="author">  
              <ul>
                <li *ngFor="let item of items">              
                  <ng-container *ngIf="item.authors | o1i; let author">
                    <span>Author</span>
                    <a href="#">{{ author.title }}</a>
                  </ng-container>
                </li>
              </ul>  
            </td>

            <td class="comment">              
              <ul>
                <li *ngFor="let item of items">
                  <span>Comment</span>
                  <em>{{ item.commentCount || '—' }}</em>
                </li>
              </ul>  
            </td>

            <td class="date">
              <ul>
                <li *ngFor="let item of items">
                  <span>Date</span>
                  <em>{{ item.updatedAt === item.createdAt ? 'Published' : 'Modified' }} — {{ item.updatedAt | date }}</em>
                </li>
              </ul>  
            </td>
  
          </ng-container>
          </tr>
        </tbody>  
        <tfoot>
          <tr>
            <td colspan="42">
              <pagination-controls
                (pageChange)="pageNo=$event"
                [directionLinks]="false"
              ></pagination-controls>
            </td>
          </tr>
        </tfoot>  
      </table>

      <div class="footbar">
        <ng-container *ngTemplateOutlet="listingBar"></ng-container>
      </div>

    </div>

  </ng-container>
  </ng-container>
  </div>

  <ng-template #notFound>
    <div class="not-found">Not found ...</div>
  </ng-template>

</div>

<ng-template #loading>
  <div class="loading">Loading ...</div>
</ng-template>
