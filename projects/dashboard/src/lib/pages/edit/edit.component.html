<div class="host dashboard page"  *ngIf="page$ | async as page; else loading">

  <div class="main" *ngIf="page.part as part; else notFound">
  <ng-container *ngIf="data$ | async; let data">
    
    <div class="head">
  
      <div class="title">
        <h1>{{ isNew ? 'Add New ' : 'Update' }} {{ part.name }}</h1>
        <a
          class="button-outline-primary"
          [usefulRouterLink]="['admin', 'list', part.name]"
        >All {{ part.menuItem.text || 'Items' }}</a>
      </div>
  
    </div>
  
    <div class="body">
  
      <form
        [formGroup]="data.formGroup"
        (ngSubmit)="submit(part, data.formGroup)"
        #theForm="ngForm"
      >
  
        <div class="item" [class.required]="!!schema.required" *ngFor="let schema of data.formSchema">

          <label class="form-label" [for]="schema.name">{{ schema.label }}</label>
  
          <ng-container
            *ngIf="
              schema.type==='text' ||
              schema.type==='number'
            "
          >
            <input
              class="form-control"
              [id]="schema.name"
              [type]="schema.type"
              [formControlName]="schema.name"
              [placeholder]="schema.placeholder || ''"
            >
          </ng-container>
  
          <ng-container *ngIf="schema.type==='textarea'">
            <textarea
              class="form-control"
              [id]="schema.name"
              [formControlName]="schema.name"
              [placeholder]="schema.placeholder || ''"
            ></textarea>
          </ng-container>
  
          <ng-container
            *ngIf="
              schema.type==='checkbox' ||
              schema.type==='only'
            "
          >
            <label class="form-checkbox" *ngFor="let checkboxItem of schema.children || []">
              <input
                type="checkbox"
                (change)="checkboxChanges(
                  schema,
                  data.formGroup,
                  schema.children,
                  checkboxItem,
                  $event
                )"
                [checked]="checkboxItem.checked"
              >
              <span>{{ checkboxItem.text }}</span>
            </label>
          </ng-container>
  
          <ng-container *ngIf="schema.type==='locale'">
            <select class="form-select" [id]="schema.name" [formControlName]="schema.name">
              <option
                *ngFor="let localeItem of settingService.locales"
                [value]="localeItem.value"
              >{{ localeItem.text }}</option>
            </select>
          </ng-container>
  
          <ng-container *ngIf="schema.type==='type' && part.dataTypes">
            <select class="form-select" [id]="schema.name" [formControlName]="schema.name">
              <option *ngFor="let type of part.dataTypes" [value]="type.value">{{ type.text }}</option>
            </select>
          </ng-container>

          <ng-container *ngIf="schema.type==='status'">
            <select class="form-select" [id]="schema.name" [formControlName]="schema.name">
              <option value="publish">Publish</option>
              <option value="draft">Draft</option>
            </select>
          </ng-container>

          <ng-container *ngIf="schema.type==='json' && schema.data">
            <nguix-dashboard-json-editor
              [type]="schema.data.type"
              [currentData]="schema.data.currentData"
              [schema]="schema.data.schema"
              [recordKey]="schema.data.recordKey"
              (save)="jsonChanges(
                schema,
                data.formGroup,
                $event
              )"
            ></nguix-dashboard-json-editor>
          </ng-container>

          <ng-container *ngIf="schema.type==='link' && schema.data">
            <nguix-dashboard-link-editor
              [part]="schema.data.part"
              [items$]="schema.data.items$"
              [keys]="schema.data.keys"
              [currentData]="schema.data.currentData"
              [locale]="activeLocale"
              (save)="linkChanges(
                schema,
                data.formGroup,
                $event
              )"
            ></nguix-dashboard-link-editor>
          </ng-container>
  
        </div>
  
        <div class="actions">

          <ng-container
            *ngIf="isNew || databaseItem?.status==='draft' || databaseItem?.status==='publish'">
            <button
              class="submit button-primary"
              type="submit"
              [disabled]="!theForm.form.valid || lockdown"
            >{{ submitText }}</button>
            <a
              class="preview button-outline-primary"
              [class.disabled]="!theForm.form.valid || lockdown"
              href="javascript:void(0)"
              (click)="
                !theForm.form.valid || lockdown
                  ? false
                  : dataService.previewItem(part)
              "
            >Preview</a>
          </ng-container>

          <ng-container *ngIf="databaseItem && !isCopy">

            <ng-container
              *ngIf="databaseItem.status==='draft' || databaseItem.status==='publish'">
              <a
                class="archive button-dark"                
                href="javascript:void(0)"
                (click)="dataService.archiveItem(part, databaseItem.origin)"
              >Archive</a>
              <a
                class="trash button-danger"
                href="javascript:void(0)"
                (click)="dataService.removeItem(part, databaseItem.origin)"
              >Trash</a>
            </ng-container>
    
            <ng-container *ngIf="databaseItem.status==='archive'">  
              <a
                class="unarchive button-success"
                href="javascript:void(0)"
                (click)="dataService.unarchiveItem(part, databaseItem.origin)"
              >Unarchive</a>
            </ng-container>
  
            <ng-container *ngIf="databaseItem.status==='trash'">
              <a
                class="trash button-success"
                href="javascript:void(0)"
                (click)="dataService.restoreItem(part, databaseItem.origin)"
              >Restore</a>  
            </ng-container>
  
          </ng-container>
  
        </div>
  
      </form>
  
    </div>

  </ng-container>
  </div>
  
  <ng-template #notFound>
    <div class="not-found">Not found ...</div>
  </ng-template>
</div>

<ng-template #loading>
  <div class="loading">Loading ...</div>
</ng-template>
