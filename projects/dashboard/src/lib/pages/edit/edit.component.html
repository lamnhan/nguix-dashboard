<div class="host dashboard page"  *ngIf="page$ | async as page; else loading">

  <div class="main" *ngIf="page.part as part; else notFound">
  <ng-container *ngIf="data$ | async; let data">
    
    <div class="head">
  
      <div class="title">
        <h1>{{ isNew ? 'Add New ' : 'Update' }} {{ part.name }}</h1>
        <a
          class="button-outline-primary"
          [usefulRouterLink]="['admin', 'list', part.name]"
        >All {{ part.menuItem.text || 'Items' }}</a>
      </div>
  
    </div>
  
    <div class="body">
  
      <form
        [formGroup]="data.formGroup"
        (ngSubmit)="submit(part, data.formGroup)"
        #theForm="ngForm"
      >
  
        <div class="group" *ngFor="let schema of data.formSchema">
          <label class="form-label" [for]="schema.name">{{ schema.label }}</label>
  
          <ng-container
            *ngIf="
              schema.type==='input' ||
              schema.type==='number'
            "
          >
            <input
              class="form-control"
              [id]="schema.name"
              [type]="schema.type"
              [formControlName]="schema.name"
              [placeholder]="schema.placeholder || ''"
            >
          </ng-container>
  
          <ng-container *ngIf="schema.type==='textarea'">
            <textarea
              class="form-control"
              [id]="schema.name"
              [formControlName]="schema.name"
              [placeholder]="schema.placeholder || ''"
            ></textarea>
          </ng-container>
  
          <ng-container
            *ngIf="
              schema.type==='checkbox' ||
              schema.type==='only'
            "
          >
            <label *ngFor="let checkboxItem of schema.children || []">
              <input
                type="checkbox"
                (change)="checkboxChanges(
                  schema.name,
                  data.formGroup,
                  schema.children,
                  checkboxItem,
                  $event
                )"
                [checked]="checkboxItem.checked"
              >
              <span>{{ checkboxItem.text }}</span>
            </label>
          </ng-container>
  
          <ng-container *ngIf="schema.type==='status'">
            <select [id]="schema.name" [formControlName]="schema.name">
              <option value="publish">Publish</option>
              <option value="draft">Draft</option>
            </select>
          </ng-container>
  
          <ng-container *ngIf="schema.type==='locale'">
            <select [id]="schema.name" [formControlName]="schema.name">
              <option
                *ngFor="let localeItem of settingService.locales"
                [value]="localeItem.value"
              >{{ localeItem.text }}</option>
            </select>
          </ng-container>
  
        </div>
  
        <div class="actions">
  
          <button
            class="submit button-primary"
            type="submit"
            [disabled]="!theForm.form.valid || lockdown"
          >{{ submitText }}</button>
          <a
            class="preview button-outline-primary"
            [class.disabled]="!theForm.form.valid || lockdown"
            href="#"
            (click)="
              !theForm.form.valid || lockdown
                ? false
                : dashboardService.previewItem(part);
              false
            "
          >Preview</a>
  
          <ng-container *ngIf="!isNew && databaseItem">
  
            <a
              class="unarchive button-success"
              *ngIf="databaseItem.status==='archive'; else archived"
              href="#"
              (click)="dashboardService.unarchiveItem(part, databaseItem.origin); false"
            >Unarchive</a>
            <ng-template #archived>
              <a
                class="archive button-dark"                
                href="#"
                (click)="dashboardService.archiveItem(part, databaseItem.origin); false"
              >Archive</a>
            </ng-template>
  
            <a
              class="trash button-success"
              *ngIf="databaseItem.status==='trash'; else trash"
              href="#"
              (click)="dashboardService.restoreItem(part, databaseItem.origin); false"
            >Restore</a>
            <ng-template #trash>
              <a
                class="trash button-danger"
                href="#"
                (click)="dashboardService.removeItem(part, databaseItem.origin); false"
              >Trash</a>
            </ng-template>
  
          </ng-container>
  
        </div>
  
      </form>
  
    </div>

  </ng-container>
  </div>
  
  <ng-template #notFound>
    <div class="not-found">Not found ...</div>
  </ng-template>
</div>

<ng-template #loading>
  <div class="loading">Loading ...</div>
</ng-template>
